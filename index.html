<!DOCTYPE html>
<html>
<head>
  <title>Razorpay Test Payment ₹10</title>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; }
    .card-box { background: #f0f0f0; padding: 15px; border-radius: 10px; max-width: 350px; margin-bottom: 20px; }
    button { padding: 12px 25px; font-size: 18px; cursor: pointer; }
  </style>
</head>
<body>

<h2>Razorpay Test Payment (₹10)</h2>

<div class="card-box">
  <h3>Mastercard Test Card (India)</h3>
  <p><b>Card Number:</b> 2305 3242 5784 8228</p>
  <p><b>CVV:</b> Any 3 digits</p>
  <p><b>Expiry:</b> Any future date</p>
  <p><b>OTP:</b> 123456</p>
  <p><b>Mode:</b> Test Mode Only</p>
</div>

<button id="payBtn">Pay ₹10</button>

<script>
document.getElementById("payBtn").onclick = async function () {
    try {
        // 1️⃣ Call Supabase Edge Function using anon key
        const res = await fetch('https://zfcndiuombmzehnnvawm.supabase.co/functions/v1/createOrder', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpmY25kaXVvbWJtemVobm52YXdtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUzNTkyNTksImV4cCI6MjA4MDkzNTI1OX0.wfUvcghCIWsPAU7GhKS0H8GfyLotn_Kw2Zarwu4Z5ms'
            },
            body: JSON.stringify({ amount: 10 })
        });

        if (!res.ok) throw new Error("Failed to create order");

        const order = await res.json();

        // 2️⃣ Open Razorpay Checkout
        const options = {
            key: "rzp_test_RpsuZSNWqiz3O8", // Your Razorpay Test Key ID
            amount: order.amount,
            currency: order.currency,
            name: "Supabase Test Payment",
            description: "Mastercard Test",
            order_id: order.id,
            handler: function(response) {
                alert(
                    "Payment Successful!\n" +
                    "Payment ID: " + response.razorpay_payment_id + "\n" +
                    "Order ID: " + response.razorpay_order_id
                );
            },
            prefill: {
                name: "Test User",
                email: "test@example.com",
                contact: "9999999999"
            },
            theme: { color: "#3399ff" }
        };

        const rzp = new Razorpay(options);
        rzp.open();

    } catch (err) {
        console.error(err);
        alert("Error: " + err.message);
    }
};
</script>

</body>
</html>
